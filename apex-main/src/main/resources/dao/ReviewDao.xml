<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.apex.app.dao.ReviewDao">

    <select id="getSubmissionCount" resultType="java.lang.Integer">
        select count(*)
        from submission_base s
        where s.org_id = #{org_id}
    </select>

    <select id="getSubmissionIdList" resultType="java.lang.String">
        select id
        from submission_base s
        where s.org_id = #{org_id}
    </select>

    <insert id="insertPaperAllocation">
        insert into paper_allocation
        (user_id, submission_id, org_id)
        values
        <foreach collection="allocationList" item="allocation" separator=",">
            (#{allocation.userId}, #{allocation.submissionId}, #{allocation.orgId})
        </foreach>
    </insert>

    <delete id="deleteAllocationByOrgId">
        delete
        from paper_allocation
        where org_id = #{org_id}
    </delete>

    <resultMap id="AllocationResultMap" type="com.apex.app.domain.bo.PaperAllocationMapBo">
        <id column="submission_id" property="submissionId"/>
        <collection property="userList" ofType="com.apex.app.domain.model.UserBase">
            <id column="user_id" property="id"/>
            <result column="fullName" property="fullName"/>
            <result column="firstName" property="firstName"/>
            <result column="lastName" property="lastName"/>
            <result column="email" property="email"/>
            <result column="avatar" property="avatar"/>
            <result column="title" property="title"/>
            <result column="enableStatus" property="enableStatus"/>
        </collection>
    </resultMap>

    <select id="getAllocationResult" resultMap="AllocationResultMap">
        select pa.submission_id,
               pa.user_id,
               ub.email,
               ub.full_name fullName,
               ub.last_name lastName,
               ub.first_name firstName,
               ub.avatar,
               ub.title,
               ub.enable_status enableStatus
        from paper_allocation pa
                 left join user_base ub on ub.id = pa.user_id
        where org_id = #{org_id}
    </select>

</mapper>